@model IEnumerable<E_voting_System.Models.Debate>

@{
    ViewBag.Title = "Manage Debates";
    Layout = "~/Views/Shared/_PostLayout.cshtml";
}

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Cairo', sans-serif;
    }
</style>
<section class="intro">
    <div class="bg-image h-100" style="background-color: #f5f7fa;">
        <div class="mask d-flex align-items-center h-100">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    @using (Html.BeginForm("ManageDebates", "Debates", FormMethod.Post))
                                    {
                                        <table class="table table-striped mb-0 responstable">
                                            <thead style="background-color: #002d72;">
                                                <tr>
                                                    <th scope="col">
                                                        <input type="checkbox" id="selectAll" />
                                                    </th>
                                                    <th scope="col">تاريخ المناظرة</th>
                                                    <th scope="col">عنوان المناظرة</th>
                                                    <th scope="col">المرشح الأول</th>
                                                    <th scope="col">رقم قائمة المرشح الأول</th>
                                                    <th scope="col">المرشح الثاني</th>
                                                    <th scope="col">رقم قائمة المرشح الثاني</th>
                                                    <th scope="col">الحالة</th>
                                                    <th scope="col">Zoom رابط</th>
                                                    <th scope="col">الإجرائات</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @for (int i = 0; i < Model.Count(); i++)
                                                {
                                                    var item = Model.ElementAt(i);
                                                    <tr>
                                                        <td>
                                                            <input type="checkbox" name="selectedDebates" value="@item.ID" class="selectDebate" />
                                                            @Html.Hidden($"ids[{i}]", item.ID)
                                                        </td>
                                                        <td>@Html.DisplayFor(modelItem => item.Date_Of_Debate)</td>
                                                        <td>@Html.DisplayFor(modelItem => item.Topic)</td>
                                                        <td>@Html.DisplayFor(modelItem => item.First_Candidate)</td>
                                                        <td>@Html.DisplayFor(modelItem => item.First_Candidate_List)</td>
                                                        <td>@Html.DisplayFor(modelItem => item.Second_Candidate)</td>
                                                        <td>@Html.DisplayFor(modelItem => item.Second_Candidate_List)</td>
                                                        <td>@Html.DisplayFor(modelItem => item.Status)</td>
                                                        <td>@Html.DisplayFor(modelItem => item.Zoom_link)</td>
                                                        <td>
                                                            <button type="button" class="btn btn-info btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#detailsModal-@item.ID">Show More</button>
                                                            @if (item.Status != "Approved" && item.Status != "Rejected")
                                                            {
                                                                <button type="submit" name="action" value="approve" class="btn btn-success btn-sm mt-2" formaction="@Url.Action("Approve", "Debates", new { id = item.ID })">Approve</button>
                                                                <button type="submit" name="action" value="reject" class="btn btn-danger btn-sm mt-2" formaction="@Url.Action("Reject", "Debates", new { id = item.ID })">Reject</button>
                                                            }
                                                            <a href="@Url.Action("Edit", "Debates", new { id = item.ID })" class="btn btn-primary btn-sm mt-2">Edit</a>
                                                        </td>
                                                    </tr>

                                                    <!-- Modal -->
                                                    <div class="modal fade" id="detailsModal-@item.ID" tabindex="-1" aria-labelledby="detailsModalLabel-@item.ID" aria-hidden="true">
                                                        <div class="modal-dialog modal-lg">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="detailsModalLabel-@item.ID">Debate Details</h5>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <p><strong>Title:</strong> @item.Topic</p>
                                                                    <p><strong>Date:</strong> @item.Date_Of_Debate</p>
                                                                    <p><strong>First Candidate:</strong> @item.First_Candidate</p>
                                                                    <p><strong>Second Candidate:</strong> @item.Second_Candidate</p>
                                                                    <p><strong>Status:</strong> @item.Status</p>
                                                                    <p><strong>Zoom Link:</strong> @item.Zoom_link</p>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                                <tr>
                                                    <td colspan="10">
                                                        <button type="submit" name="action" value="delete" class="btn btn-danger btn-sm">Delete Selected</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.getElementById("selectAll").addEventListener("click", function () {
        var checkboxes = document.querySelectorAll(".selectDebate");
        for (var checkbox of checkboxes) {
            checkbox.checked = this.checked;
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<style>
    html,
    body,
    .intro {
        height: 100%;
    }

    table {
        width: 100%;
        margin: 0 auto;
    }

        table td,
        table th {
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }

    thead th {
        color: #fff;
    }

    .card {
        border-radius: .5rem;
    }

    .table-scroll {
        border-radius: .5rem;
    }

    thead {
        top: 0;
        position: sticky;
    }
    .navbar {
        margin-bottom: 20px;
        background: #002d72;
        color: #fff;
        border-radius: 0.5rem;
    }

</style>
